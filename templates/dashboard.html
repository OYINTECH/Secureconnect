{% extends "base.html" %}
{% block title %}Dashboard - SecureConnect{% endblock %}
{% block content %}

<h1>Welcome to Your Dashboard, {{ current_user.id }}</h1>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- Game Login Challenge Notice -->
<div class="alert alert-info mt-4">
    <strong>Note:</strong> Access to SecureConnect begins with a special login challenge: emoji pattern unlock, rhythm typing, and developer-set life questions.
</div>

<!-- File Upload -->
<div class="file-upload-section mt-4">
    <h3>Upload a Document</h3>
    <form method="POST" enctype="multipart/form-data">
        <div class="mb-3">
            <input type="file" name="file" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">Upload</button>
    </form>
    {% if filename %}
    <div class="mt-3">
        <p><strong>Uploaded File:</strong> {{ filename }}</p>
    </div>
    {% endif %}
</div>

<!-- Hide/Reveal Messages -->
<div class="mt-4">
    <a href="{{ url_for('hide_message') }}" class="btn btn-outline-dark">Hide Message in Image</a>
    <a href="{{ url_for('reveal_message') }}" class="btn btn-outline-primary ms-2">Reveal Hidden Message</a>
</div>

<!-- Network Tools -->
<div class="mt-4">
    <a href="{{ url_for('scan_ip') }}" class="btn btn-outline-info">IP Address Scanner</a>
    <a href="{{ url_for('nmap_scan') }}" class="btn btn-outline-danger ms-2">Nmap Port Scanner</a>
    <a href="{{ url_for('download_scan_results') }}" class="btn btn-outline-success ms-2">Download Nmap Report</a>
</div>

<!-- Encrypted Message -->
<div class="encrypted-message-section mt-5">
    <h4>Send an Encrypted Message</h4>
    <form method="POST" action="{{ url_for('send_message') }}">
        <div class="mb-3">
            <input type="email" name="recipient" class="form-control" placeholder="Recipient Email" required>
        </div>
        <div class="mb-3">
            <textarea name="message" class="form-control" rows="3" placeholder="Your secret message..." required></textarea>
        </div>
        <button type="submit" class="btn btn-success">Send Message</button>
    </form>
</div>

<!-- Inbox -->
<div class="mt-5">
    <h4>Inbox</h4>
    <input type="text" id="searchBox" class="form-control mb-3" placeholder="Search messages...">
    {% if inbox %}
        <ul class="list-group" id="inboxList">
            {% for msg in inbox %}
                <li class="list-group-item">
                    <strong>From:</strong> {{ msg.from }}<br>
                    <strong>Message:</strong> {{ msg.text }}<br>
                    <small class="text-muted">Received: {{ msg.time }}</small>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-muted">No messages yet.</p>
    {% endif %}
</div>

<!-- Search Script -->
<script>
document.getElementById('searchBox').addEventListener('input', function () {
    const term = this.value.toLowerCase();
    document.querySelectorAll('#inboxList li').forEach(item => {
        const text = item.innerText.toLowerCase();
        item.style.display = text.includes(term) ? '' : 'none';
    });
});
</script>

<!-- Stats and IP Info -->
<div class="quick-stats mt-4">
    <h5>Quick Stats</h5>
    <p><strong>Total Users:</strong> 120</p>
    <p><strong>New Messages:</strong> 7</p>
</div>

<div class="user-info mt-4">
    <h5>Your IP Address: {{ user_ip }}</h5>
</div>

<!-- Logout -->
<div class="mt-4">
    <p>You are logged in! <a href="{{ url_for('logout') }}">Logout</a></p>
</div>

{% endblock %}
